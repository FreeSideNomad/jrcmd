<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/main :: layout(~{::title}, ~{::content})}">
<head>
    <title>Queue Stats - E2E Test App</title>
</head>
<body>
<div th:fragment="content">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-inbox"></i> Queue Statistics</h2>
        <button class="btn btn-outline-secondary" onclick="location.reload()">
            <i class="bi bi-arrow-clockwise"></i> Refresh
        </button>
    </div>

    <!-- Summary Cards -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card text-center">
                <div class="card-body">
                    <div class="display-4" th:text="${allQueues.size()}">0</div>
                    <div class="text-muted">Total Queues</div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center">
                <div class="card-body">
                    <div class="display-4" th:classappend="${totalDepth > 0} ? 'text-warning'" th:text="${totalDepth}">0</div>
                    <div class="text-muted">Messages in Queues</div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center">
                <div class="card-body">
                    <div class="display-4 text-secondary" th:text="${totalArchive}">0</div>
                    <div class="text-muted">Messages in Archive</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Queues by Domain -->
    <div th:each="entry : ${queuesByDomain}" class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="bi bi-database"></i>
                <span th:text="${entry.key}">domain</span>
                <span class="badge bg-secondary" th:text="${entry.value.size() + ' queues'}">0 queues</span>
            </h5>
        </div>
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>Queue Name</th>
                        <th>Type</th>
                        <th class="text-end">Depth</th>
                        <th class="text-end">Archive</th>
                        <th>Oldest Message</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="queue : ${entry.value}">
                        <td><code th:text="${queue.queueName}">queue</code></td>
                        <td th:switch="${queue.queueType()}">
                            <span th:case="'commands'" class="badge bg-primary">Commands</span>
                            <span th:case="'replies'" class="badge bg-info">Replies</span>
                            <span th:case="'process_replies'" class="badge bg-success">Process Replies</span>
                            <span th:case="*" class="badge bg-secondary">Other</span>
                        </td>
                        <td class="text-end">
                            <span th:if="${queue.queueDepth > 0}" class="badge bg-warning" th:text="${queue.queueDepth}">0</span>
                            <span th:if="${queue.queueDepth == 0}" class="text-muted">0</span>
                        </td>
                        <td class="text-end" th:text="${queue.archiveSize}">0</td>
                        <td>
                            <span th:if="${queue.oldestMessageAt != null}" th:text="${#temporals.format(queue.oldestMessageAt, 'yyyy-MM-dd HH:mm:ss')}">time</span>
                            <span th:if="${queue.oldestMessageAt == null}" class="text-muted">-</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div th:if="${allQueues.isEmpty()}" class="alert alert-info">
        <i class="bi bi-info-circle"></i> No queues found. Send a command to create queues.
    </div>

    <script>
        // Auto-refresh every 5 seconds if there are messages in queue
        (function() {
            const totalDepth = [[${totalDepth}]];
            if (totalDepth > 0) {
                setTimeout(() => window.location.reload(), 5000);
            }
        })();
    </script>
</div>
</body>
</html>
