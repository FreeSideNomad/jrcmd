# E2E Test Application Configuration (Base)
# This is the base configuration. Use with additional profiles:
#   e2e,ui    - UI only (no worker)
#   e2e,worker - Worker only (no web server)
#   e2e       - Both UI and worker (default)

spring:
  datasource:
    url: jdbc:postgresql://localhost:5433/commandbus_test
    username: postgres
    password: postgres
    hikari:
      maximum-pool-size: 50
      minimum-idle: 10
      connection-timeout: 30000
      idle-timeout: 300000
      max-lifetime: 900000
  flyway:
    enabled: true
    locations: classpath:db/migration
  thymeleaf:
    prefix: classpath:/templates/e2e/
    cache: false

commandbus:
  enabled: true
  domain: test
  default-max-attempts: 3
  backoff-schedule: [1, 2, 5]
  worker:
    visibility-timeout: 30
    poll-interval-ms: 500
    concurrency: 4
    use-notify: true
    auto-start: true
  process:
    enabled: true
    domain: reporting
    reply-queue: reporting__process_replies
    auto-start: true
    archive-messages: true  # Archive replies for debugging
  process-step:
    enabled: true
    batch-size: 100                    # Processes to claim per poll (per worker)
    processing-timeout-seconds: 60     # Timeout before stale claims are released
    poll-interval-ms: 1000             # Poll for pending processes
    retry-poll-interval-ms: 5000       # Poll for retry-due processes
    timeout-check-interval-ms: 60000   # Check wait timeouts
    deadline-check-interval-ms: 60000  # Check process deadlines
    auto-start: true
  # Command step configuration for COMMAND_STEP execution model
  command-steps:
    bookFx:
      domain: fx
      command-type: BookFx
      timeout: 30s
    submitPayment:
      domain: network
      command-type: SubmitPayment
      timeout: 60s

server:
  port: 8080

logging:
  level:
    com.ivamare.commandbus: DEBUG
